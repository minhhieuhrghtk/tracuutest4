<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tra c·ª©u b√†n ti·ªác</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ecfdf5;
  padding: 20px;
  color: #065f46;
}

.container {
  max-width: 420px;
  margin: auto;
  background: white;
  border-radius: 18px;
  padding: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

h2 {
  text-align: center;
}

input, button {
  width: 100%;
  box-sizing: border-box;
  padding: 12px;
  margin-top: 8px;
  border-radius: 14px;
  border: 1px solid #a7f3d0;
  font-size: 16px;
}

button {
  background: #22c55e;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

#result {
  margin-top: 10px;
  padding: 10px;
  background: #f0fdf4;
  border-radius: 12px;
}

.map {
  margin-top: 14px;
  padding-top: 10px;
  border-top: 2px dashed #34d399;
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.row {
  display: flex;
  gap: 16px;
}

.table {
  width: 65px;
  height: 65px;
  border-radius: 50%;
  background: #bbf7d0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  position: relative;
  cursor: pointer;
}

.table.highlight {
  background: #22c55e;
  color: white;
  box-shadow: 0 0 0 4px #86efac;
}

.status {
  position: absolute;
  bottom: -6px;
  right: -6px;
  background: white;
  border-radius: 50%;
  font-size: 14px;
  padding: 2px 5px;
}

#guestList {
  display: none;
  margin-top: 10px;
  background: #ecfdf5;
  padding: 10px;
  border-radius: 12px;
}
</style>
</head>

<body>

<div class="container">
<h2>üéâ Tra c·ª©u b√†n ti·ªác</h2>

<input id="username" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n">
<button onclick="traCuu()">üîç Tra c·ª©u</button>

<div id="result"></div>

<button id="checkinBtn" style="display:none" onclick="xacNhanDen()">‚úÖ T√¥i ƒë√£ ƒë·∫øn</button>

<div class="map">

<!-- H√ÄNG 1 -->
<div class="row">
  <div class="table" data-ban="2">2<div class="status" id="s-2">‚ùå</div></div>
  <div class="table" data-ban="1">1<div class="status" id="s-1">‚ùå</div></div>
  <div class="table" data-ban="3">3<div class="status" id="s-3">‚ùå</div></div>
</div>

<!-- H√ÄNG 2 ‚Üí 9 -->
<script>
let ban = 4;
for (let i = 0; i < 8; i++) {
  document.write('<div class="row">');
  for (let j = 0; j < 3; j++) {
    document.write(`<div class="table" data-ban="${ban}">${ban}<div class="status" id="s-${ban}">‚ùå</div></div>`);
    ban++;
  }
  document.write('</div>');
}
</script>

</div>

<div id="guestList"></div>

<p style="text-align:center;font-size:13px">üì∏ Vui l√≤ng ch·ª•p m√†n h√¨nh sau khi tra c·ª©u</p>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnWMIpqfGOMbFPWl4_8JIBEpqnv71DmrsBimq6bxEQO8FAPVeI1X2NuVqFH-qxmBn9TPs5e2eunJ7O/pub?gid=0&single=true&output=csv";
const CHECKIN_API = "https://script.google.com/macros/s/AKfycbyIr-BzA_5uueeL-OZP8-adCyLyz0pMBxST0SmbDzdqMFsFe5qD7ffPw-QUsn7qkpZYkw/exec";

const userMap = {};
const guestsByTable = {};

fetch(SHEET_URL)
  .then(r => r.text())
  .then(t => {
    t.trim().split(/\r?\n/).forEach(l => {
      const c = l.split(',');
      if (c.length < 2) return;
      const name = c[0].trim();
      const ban = c[1].trim();
      const lucky = c[2]?.trim() || '';
      const arrived = c[3]?.trim() === '1';

      userMap[name.toLowerCase()] = { ban, lucky, arrived };

      if (!guestsByTable[ban]) guestsByTable[ban] = [];
      guestsByTable[ban].push(name);

      if (arrived) document.getElementById(`s-${ban}`).innerText = '‚úÖ';
    });
  });

document.querySelectorAll('.table').forEach(t => {
  t.onclick = () => showGuests(t.dataset.ban);
});

function traCuu() {
  document.querySelectorAll('.table').forEach(t => t.classList.remove('highlight'));
  guestList.style.display = 'none';

  const name = username.value.trim().toLowerCase();
  if (!name || !userMap[name]) {
    result.innerHTML = '‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin';
    return;
  }

  const info = userMap[name];
  document.querySelector(`.table[data-ban="${info.ban}"]`).classList.add('highlight');

  result.innerHTML = `
    üçΩ B√†n: <b>${info.ban}</b><br>
    üçÄ S·ªë may m·∫Øn: <b>${info.lucky || '‚Äî'}</b><br>
    ${info.arrived ? '‚úÖ B·∫°n ƒë√£ check-in' : '‚ùì B·∫°n ch∆∞a check-in'}
  `;

  checkinBtn.style.display = info.arrived ? 'none' : 'block';
}

function xacNhanDen() {
  fetch(CHECKIN_API, {
    method: 'POST',
    body: JSON.stringify({ username: username.value })
  }).then(() => {
    alert('‚úÖ Check-in th√†nh c√¥ng!');
    location.reload();
  });
}

function showGuests(ban) {
  const list = guestsByTable[ban] || [];
  guestList.innerHTML = `<b>üë• Kh√°ch b√†n ${ban}</b><br>` +
    list.map(n => '‚Ä¢ ' + n).join('<br>');
  guestList.style.display = 'block';
}
</script>

</body>
</html>
